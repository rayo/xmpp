<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE xep SYSTEM 'xep.dtd' [
  <!ENTITY % ents SYSTEM 'xep.ent'>
%ents;
]>
<?xml-stylesheet type='text/xsl' href='xep.xsl'?>
<xep>
<header>
  <title>Rayo</title>
  <abstract>This specification describes the Rayo third-party call control protocol.</abstract>
  <legal>
    <copyright>This XMPP Extension Protocol is copyright (c) 2011 by the XMPP Standards Foundation (XSF).</copyright>
    <permissions>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the &quot;Specification&quot;), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</permissions>
    <warranty>## NOTE WELL: This Specification is provided on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</warranty>
    <liability>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</liability>
    <conformance>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<link url='http://www.xmpp.org/extensions/ipr-policy.shtml'>http://www.xmpp.org/extensions/ipr-policy.shtml</link>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</conformance>
  </legal>
  <number>xxxx</number>
  <status>ProtoXEP</status>
  <type>Standards Track</type>
  <sig>Standards</sig>
  <approver>Council</approver>
  <dependencies>
    <spec>XMPP Core</spec>
  </dependencies>
  <supersedes/>
  <supersededby/>
  <shortname>NOT_YET_ASSIGNED</shortname>
  <author>
    <firstname>Jose</firstname>
    <surname>de Castro</surname>
    <email>jdecastro@voxeo.com</email>
    <jid>jdecastro@voxeo.com</jid>
    <uri>http://voxeolabs.com</uri>
  </author>
  <author>
    <firstname>Ben</firstname>
    <surname>Langfeld</surname>
    <email>ben@langfeld.me</email>
    <jid>ben@langfeld.me</jid>
    <uri>http://langfeld.me</uri>
  </author>
  <revision>
    <version>0.0.1</version>
    <date>2011-12-05</date>
    <initials>jdc</initials>
    <remark><p>First draft.</p></remark>
  </revision>
</header>
<section1 topic='Introduction' anchor='intro'>
  <p>Rayo is an extension for controlling phone calls, audio mixers and a variety of advanced media resources such as speech recognizers, speech synthesizers and audio recorders. These capabilities can be combined to create a wide variety of applications such as menu-based phone systems, in-game conferencing and anonymous dating services. Unlike <a href='xep-0166.html'>Jingle</a>...</p>
</section1>
<section1 topic='How it works' anchor='howitworks'>
  <ol>
    <li>A call arrives to the Rayo Server</li>
    <li>The Rayo Server uses the incoming call's matadata (e.g. SIP headers) to determine the JID of the controlling party</li>
    <li>An &lt;offer/&gt; is sent to the controlling party</li>
    <li></li>
    <li></li>
    <li></li>
  </ol>
</section1>
<section1 topic='Requirements' anchor='reqs'>
  <p>The protocol defined herein is designed to meet the following requirements:</p>
  <ol>
    <li><strong>Call Control:</strong> Incoming calls are "offered" to clients at which point they can be answered, rejected, redirected to another destination, etc. Evey attempt is made to be shield the Rayo client from the low level telephony protocol (e.g. SIP, Jingle, PSTN, etc.)</li>
    <li><strong>Audio File Playback:</strong> A compatible Rayo server will fetch a file from a a specified URL and play the containing audio to the caller.</li>
    <li><strong>Speech Synthesis / TTS:</strong> In cases where dynamic data must be spoken, a Speech Synthesis engine many be used to play computer generated speech to the caller.</li>
    <li><strong>Touch-tone Events / DTMF:</strong> Rayo surfaces real-time event when the caller presses keys on their touch-tone keypad.</li>
    <li><strong>Speech Recognition:</strong> Enables the phone application to take spoken queues allowing for sophisticated voice-driven menus and directory services.</li>
    <li><strong>Call Recording:</strong> Can be used to capture the caller's voice (e.g. Voicemail) or both sides of the call for auditing and compliance purposes.</li>
    <li><strong>Mixing:</strong> Typically referred to as an audio "conference" calls can be joined together so that the participants can hear each other in real-time.</li>
  </ol>
</section1>
<section1 topic='Glossary' anchor='glossary'>
  <table caption='Glossary'>
    <tr>
      <th>Term</th>
      <th>Definition</th>
    </tr>
    <tr>
      <td>Commands</td>
      <td>Commands may be executed against a given call, component or mixer and can be considered completed as soon as they get a response.</td>
    </tr>
    <tr>
      <td>Component</td>
      <td>Components extend the Rayo protocol by providing additional media and call control functionality. Components are similar to commands, but have a lifecycle attached to them. A component, once created and attached to a call or mixer, will respond giving an ID that it is known by. The component will then begin execution, and may trigger events or have commands issued to it. Finally, once the component is stopped or comes to an end naturally, it will issue a special &lt;complete/&gt; event</td>
    </tr>
  </table>
</section1>
<section1 topic='Concepts and Approach' anchor='concepts'>
  <p></p>
</section1>
<section1 topic='Session Flow' anchor='session'>
</section1>
<section1 topic='Formal Definition' anchor='def'>
  <section2 topic='Call target/source URI' anchor='def-uri'>
  </section2>
  <section2 topic='Offer Element' anchor='def-offer'>
    <p>The offer element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The attributes of the offer element are as follows.</p>
    <table caption='Attributes of Offer Element'>
      <tr>
        <th>Attribute</th>
        <th>Definition</th>
        <th>Inclusion</th>
      </tr>
      <tr>
        <td>to</td>
        <td>A valid Rayo URI indicating the target of the call as described under <link url='#def-uri'>Call target/source URI</link>.</td>
        <td>REQUIRED</td>
      </tr>
      <tr>
        <td>from</td>
        <td>A valid Rayo URI indicating the source of the call as described under <link url='#def-uri'>Call target/source URI</link>.</td>
        <td>REQUIRED</td>
      </tr>
    </table>
  </section2>
  <section2 topic='Header Element' anchor='def-header'>
    <p>The header element MUST be empty.</p>
    <p>The attributes of the header element are as follows.</p>
    <table caption='Attributes of Header Element'>
      <tr>
        <th>Attribute</th>
        <th>Definition</th>
        <th>Inclusion</th>
      </tr>
      <tr>
        <td>name</td>
        <td>A string representing the name by which the header may be known.</td>
        <td>REQUIRED</td>
      </tr>
      <tr>
        <td>value</td>
        <td>A string value for the named header.</td>
        <td>REQUIRED</td>
      </tr>
    </table>
  </section2>
  <section2 topic='Accept Element' anchor='def-accept'>
    <p>The accept element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The accept element has no attributes.</p>
  </section2>
  <section2 topic='Answer Element' anchor='def-answer'>
    <p>The answer element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The answer element has no attributes.</p>
  </section2>
  <section2 topic='Redirect Element' anchor='def-redirect'>
    <p>The redirect element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The attributes of the redirect element are as follows.</p>
    <table caption='Attributes of Offer Element'>
      <tr>
        <th>Attribute</th>
        <th>Definition</th>
        <th>Inclusion</th>
      </tr>
      <tr>
        <td>to</td>
        <td>A valid Rayo URI indicating the new target for the call as described under <link url='#def-uri'>Call target/source URI</link>.</td>
        <td>REQUIRED</td>
      </tr>
    </table>
  </section2>
  <section2 topic='Reject Element' anchor='def-reject'>
    <p>The reject element MUST contain a single reject reason element (for which see <link url='#def-reject-reason'>Reject Reason Element</link>). It MAY also contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The reject element has no attributes.</p>
  </section2>
  <section2 topic='Dial Element' anchor='def-dial'>
    <p>The dial element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The attributes of the dial element are as follows.</p>
    <table caption='Attributes of Dial Element'>
      <tr>
        <th>Attribute</th>
        <th>Definition</th>
        <th>Inclusion</th>
      </tr>
      <tr>
        <td>to</td>
        <td>A valid Rayo URI indicating the target of the call as described under <link url='#def-uri'>Call target/source URI</link>.</td>
        <td>REQUIRED</td>
      </tr>
      <tr>
        <td>from</td>
        <td>A valid Rayo URI indicating the source of the call as described under <link url='#def-uri'>Call target/source URI</link>.</td>
        <td>REQUIRED</td>
      </tr>
    </table>
  </section2>
  <section2 topic='Ringing Element' anchor='def-ringing'>
    <p>The ringing element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The ringing element has no attributes.</p>
  </section2>
  <section2 topic='Answered Element' anchor='def-answered'>
    <p>The answered element MAY be empty or contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The answered element has no attributes.</p>
  </section2>
  <section2 topic='End Element' anchor='def-end'>
    <p>The end element MUST contain a single end reason element (for which see <link url='#def-end-reason'>End Reason Element</link>). It MAY also contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The end element has no attributes.</p>
  </section2>
  <section2 topic='Hangup Element' anchor='def-hangup'>
    <p>The hangup element MAY contain one or more header elements (for which see <link url='#def-header'>Header Element</link>).</p>
    <p>The hangup element has no attributes.</p>
  </section2>
  <section2 topic='Components' anchor='def-components'>
    <section3 topic='Media Output' anchor='def-component-output'>
      <p>An output component is used to instruct the server to generate audible output to a call or mixer.</p>
      <p>The output element MUST contain a single CDATA entitiy containing the SSML document to render.</p>
      <p>The attributes of the output element are as follows.</p>
      <table caption='Attributes of Output Element'>
        <tr>
          <th>Attribute</th>
          <th>Definition</th>
          <th>Possible Values</th>
          <th>Default</th>
          <th>Inclusion</th>
        </tr>
        <tr>
          <td>interrupt-on</td>
          <td>The type of media input to allow interrupting the output.</td>
          <td>any|dtmf|speech|none</td>
          <td>none</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>start-offset</td>
          <td></td>
          <td>A positive integer in ms.</td>
          <td>0</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>start-paused</td>
          <td>Wether or not to start the output in the paused state, ready to be resumed.</td>
          <td>true|false</td>
          <td>false</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>repeat-interval</td>
          <td>The amount of time to wait between successive repetitions of the document.</td>
          <td>A positive integer in ms.</td>
          <td>0</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>repeat-times</td>
          <td>The number of times to produce the requested output before considering it to be complete.</td>
          <td>A positive integer.</td>
          <td>1</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>max-time</td>
          <td>The maximum time the output should be allowed to run for before being force-terminated.</td>
          <td>A positive integer in ms.</td>
          <td>-1</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>voice</td>
          <td>The voice with which to speak the requested document.</td>
          <td>Any voice supported by the TTS engine.</td>
          <td>allison</td>
          <td>OPTIONAL</td>
        </tr>
      </table>
      <section4 topic='Commands' anchor='def-component-output-commands'>
        <p>The input component supports the component Stop command, along with the following.</p>
        <section5 topic='Pause' anchor='def-component-output-commands-pause'>
          <p>Instructs the server to pause the media output, but not terminate the component.</p>
          <p>The pause element MUST be empty.</p>
          <p>The pause element has no attributes.</p>
        </section5>
        <section5 topic='Resume' anchor='def-component-output-commands-resume'>
          <p>Instructs the server to resume a paused output.</p>
          <p>The resume element MUST be empty.</p>
          <p>The resume element has no attributes.</p>
        </section5>
        <section5 topic='SpeedUp' anchor='def-component-output-commands-speedup'>
          <p>Instructs the server to increase the speed by a unit amount.</p>
          <p>The speed-up element MUST be empty.</p>
          <p>The speed-up element has no attributes.</p>
        </section5>
        <section5 topic='SpeedDown' anchor='def-component-output-commands-speeddown'>
          <p>Instructs the server to reduce the speed by a unit amount.</p>
          <p>The speed-down element MUST be empty.</p>
          <p>The speed-down element has no attributes.</p>
        </section5>
        <section5 topic='VolumeUp' anchor='def-component-output-commands-volumeup'>
          <p>Instructs the server to increase the volume by a unit amount.</p>
          <p>The volume-up element MUST be empty.</p>
          <p>The volume-up element has no attributes.</p>
        </section5>
        <section5 topic='VolumeDown' anchor='def-component-output-commands-volumedown'>
          <p>Instructs the server to reduce the volume by a unit amount.</p>
          <p>The volume-down element MUST be empty.</p>
          <p>The volume-down element has no attributes.</p>
        </section5>
        <section5 topic='Seek' anchor='def-component-output-commands-seek'>
          <p>Instructs the server to move the play marker of the output forward or back in time before resuming output.</p>
          <p>The seek element MUST be empty.</p>
          <p>The attributes of the seek element are as follows.</p>
          <table caption='Attributes of Seek Element'>
            <tr>
              <th>Attribute</th>
              <th>Definition</th>
              <th>Possible Values</th>
              <th>Inclusion</th>
            </tr>
            <tr>
              <td>direction</td>
              <td>The direction in time in which to move the current play marker.</td>
              <td>forward|back</td>
              <td>REQUIRED</td>
            </tr>
            <tr>
              <td>amount</td>
              <td>A time value by which to move the play marker, in milliseconds</td>
              <td>A positive integer, in ms.</td>
              <td>REQUIRED</td>
            </tr>
          </table>
        </section5>
      </section4>
      <section4 topic='Events' anchor='def-component-output-events'>
        <section5 topic='Complete' anchor='def-component-output-events-complete'>
          <p>The complete element MUST contain a valid completion reason element. Possible completion reasons are as follows, in addition to the standard component completion reasons.</p>
          <section6 topic='Success' anchor='def-component-output-events-complete-success'>
            <p>Indicates that the output was completed successfully.</p>
            <p>The nomatch element MUST be empty.</p>
            <p>The nomatch element has no attributes.</p>
          </section6>
        </section5>
      </section4>
    </section3>
    <section3 topic='Media Input' anchor='def-component-input'>
      <p>An input component is used to instruct the server to gather media input from a call or mixer, using either DTMF or ASR.</p>
      <p>The input element MUST contain one or more grammar elements (for which see <link url='#def-comoponent-input-grammar'>Grammar Element</link>).</p>
      <p>The attributes of the input element are as follows.</p>
      <table caption='Attributes of Input Element'>
        <tr>
          <th>Attribute</th>
          <th>Definition</th>
          <th>Possible Values</th>
          <th>Default</th>
          <th>Inclusion</th>
        </tr>
        <tr>
          <td>mode</td>
          <td>The method by which to collect input.</td>
          <td>any|dtmf|speech</td>
          <td>any</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>hotword-timeout</td>
          <td>The amount of time for which to discard invalid input, awaiting a match.</td>
          <td>A positive integer in ms, or -1 to disable.</td>
          <td>-1</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>partial-match</td>
          <td>Wether or not the component should trigger match events whenever a partial match is detected.</td>
          <td>true|false</td>
          <td>false</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>terminator</td>
          <td>The terminator digit by which to force completion of the grammar.</td>
          <td>0-9,#,*</td>
          <td>none</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>recognizer</td>
          <td></td>
          <td>Any valid ISO 639â€‘3 language code</td>
          <td>en-US</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>initial-timeout</td>
          <td>The timeout to be applied before the first digit is captured in the case of DTMF input, or before the beginning of an utterance is detected.</td>
          <td>Any positive integer in miliseconds, or -1 for no timeout.</td>
          <td>-1</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>inter-digit-timeout</td>
          <td>The timeout to be applied between the first and subsequent captured digits.</td>
          <td>Any positive integer in miliseconds, or -1 for no timeout.</td>
          <td>-1</td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>sensitivity</td>
          <td></td>
          <td>A decimal value between 0 and 1.</td>
          <td></td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>min-confidence</td>
          <td></td>
          <td>A decimal value between 0 and 1.</td>
          <td></td>
          <td>OPTIONAL</td>
        </tr>
        <tr>
          <td>max-silence</td>
          <td>The maximum period of silence permitted before a timeout is triggered.</td>
          <td>Any positive integer in miliseconds, or -1 for no timeout.</td>
          <td>-1</td>
          <td>OPTIONAL</td>
        </tr>
      </table>
      <section4 topic='Grammar Element' anchor='def-component-input-grammar'>
        <p>The grammar element defines the grammar by which input should be matched.</p>
        <p>The grammar element MUST have either a url attribute set OR a content type and a body.</p>
        <p>The attributes of the input element are as follows.</p>
        <table caption='Attributes of Input Element'>
          <tr>
            <th>Attribute</th>
            <th>Definition</th>
            <th>Possible Values</th>
            <th>Default</th>
            <th>Inclusion</th>
          </tr>
          <tr>
            <td>url</td>
            <td>A URL to a grammar definition.</td>
            <td>Any valid URI scheme supported by the server (eg HTTP).</td>
            <td>none</td>
            <td>REQUIRED unless content-type and content are set</td>
          </tr>
          <tr>
            <td>content-type</td>
            <td>The content type of the grammar contained within the grammar element.</td>
            <td>application/grammar+voxeo|application/grammar+grxml</td>
            <td>none</td>
            <td>REQUIRED unless url is set</td>
          </tr>
        </table>
      </section4>
      <section4 topic='Commands' anchor='def-component-input-commands'>
        <p>The input component supports only the component Stop command.</p>
      </section4>
      <section4 topic='Events' anchor='def-component-input-events'>
        <section5 topic='Match' anchor='def-component-input-events-match'>
          <p>Indicates that the input received triggered a match with the specified grammar, and provides results. This constitutes a partial match, and does not signal the end of the grammar.</p>
          <p>The match element MUST contain valid interpretation and utterance elements.</p>
          <p>The attributes of the match element are as follows.</p>
          <table caption='Attributes of Match Element'>
            <tr>
              <th>Attribute</th>
              <th>Definition</th>
              <th>Possible Values</th>
              <th>Inclusion</th>
            </tr>
            <tr>
              <td>mode</td>
              <td>The method by which detection occurred.</td>
              <td>speech|dtmf</td>
              <td>REQUIRED</td>
            </tr>
            <tr>
              <td>confidence</td>
              <td>The confidence with which the interpretation matches the utterance</td>
              <td>A decimal value between 0 and 1.</td>
              <td>REQUIRED</td>
            </tr>
          </table>
        </section5>
        <section5 topic='Complete' anchor='def-component-input-events-complete'>
          <p>The complete element MUST contain a valid completion reason element. Possible completion reasons are as follows, in addition to the standard component completion reasons.</p>
          <section6 topic='Success' anchor='def-component-input-events-complete-success'>
            <p>Indicates that the input received matches the specified grammar, and provides results.</p>
            <p>The success element MUST contain valid interpretation and utterance elements.</p>
            <p>The attributes of the success element are as follows.</p>
            <table caption='Attributes of Success Element'>
              <tr>
                <th>Attribute</th>
                <th>Definition</th>
                <th>Possible Values</th>
                <th>Inclusion</th>
              </tr>
              <tr>
                <td>mode</td>
                <td>The method by which detection occurred.</td>
                <td>speech|dtmf</td>
                <td>REQUIRED</td>
              </tr>
              <tr>
                <td>confidence</td>
                <td>The confidence with which the interpretation matches the utterance</td>
                <td>A decimal value between 0 and 1.</td>
                <td>REQUIRED</td>
              </tr>
            </table>
          </section6>
          <section6 topic='Nomatch' anchor='def-component-input-events-complete-nomatch'>
            <p>Indicates that the input received did not match the specified grammar.</p>
            <p>The nomatch element MUST be empty.</p>
            <p>The nomatch element has no attributes.</p>
          </section6>
          <section6 topic='Noinput' anchor='def-component-input-events-complete-noinput'>
            <p>Indicates that the component did not receive any input.</p>
            <p>The noinput element MUST be empty.</p>
            <p>The noinput element has no attributes.</p>
          </section6>
        </section5>
      </section4>
    </section3>
  </section2>
</section1>
<section1 topic='Use Cases' anchor='usecases'>
  <p>STRONGLY RECOMMENDED.</p>
</section1>
<section1 topic='Business Rules' anchor='rules'>
  <p>OPTIONAL.</p>
</section1>
<section1 topic='Determining Support' anchor='support'>
  <p>If an entity supports Rayo, it MUST advertise that fact by returning a feature of "urn:xmpp:rayo:0" &VNOTE; in response to a &xep0030; information request. The response MUST also include features for the application formats and transport methods supported by the responding entity, as described in the relevant specifications.</p>
  <example caption="Service Discovery Information Request - Client to Server"><![CDATA[
<iq from='kingclaudius@shakespeare.lit/castle'
    id='disco1'
    to='call.rayo.org'
    type='get'>
  <query xmlns='http://jabber.org/protocol/disco#info'/>
</iq>
  ]]></example>
  <example caption="Service Discovery Information Response - Client to Server"><![CDATA[
<iq from='call.rayo.org'
    id='disco1'
    to='kingclaudius@shakespeare.lit/castle'
    type='result'>
  <query xmlns='http://jabber.org/protocol/disco#info'>
    <feature var='urn:xmpp:rayo:0'/>
  </query>
</iq>
  ]]></example>
  <example caption="Service Discovery Information Request - Server to Client"><![CDATA[
<iq from='call.rayo.org'
    id='disco1'
    to='laertes@shakespeare.lit/castle'
    type='get'>
  <query xmlns='http://jabber.org/protocol/disco#info'/>
</iq>
  ]]></example>
  <example caption="Service Discovery Information Response - Server to Client"><![CDATA[
<iq from='laertes@shakespeare.lit/castle'
    id='disco1'
    to='call.rayo.org'
    type='result'>
  <query xmlns='http://jabber.org/protocol/disco#info'>
    <feature var='urn:xmpp:rayo:client:0'/>
  </query>
</iq>
  ]]></example>
  <p>In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined in &xep0115;. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.</p>
</section1>
<section1 topic='Implementation Notes' anchor='impl'>
  <p>OPTIONAL.</p>
</section1>
<section1 topic='Security Considerations' anchor='security'>
  <section2 topic='Denial of Service' anchor='security-dos'>
    <p>Rayo sessions can be resource-intensive. Therefore, it is possible to launch a denial-of-service attack against an entity by burdening it with too many Rayo sessions. Care must be taken to accept sessions only from known entities and only if the entity's device is able to process such sessions.</p>
  </section2>
  <section2 topic='Communication Through Gateways' anchor='security-gateways'>
    <p>Rayo communications can be enabled through gateways to non-XMPP networks, whose security characteristics can be quite different from those of XMPP networks. For example, on some SIP networks authentication is optional and "from" addresses can be easily forged. Care must be taken in communicating through such gateways.</p>
  </section2>
  <section2 topic='Information Exposure' anchor='security-info'>
    <p>Mere negotiation of a Rayo session can expose sensitive information about the parties (e.g. IP addresses). Care must be taken in communicating such information, and end-to-end encryption should be used if the parties do not trust the intermediate servers or gateways.</p>
  </section2>
</section1>
<section1 topic='IANA Considerations' anchor='iana'>
  <p>This document requires no interaction with &IANA;.</p>
</section1>
<section1 topic='XMPP Registrar Considerations' anchor='registrar'>
    <section2 topic='Protocol Namespaces' anchor='registrar-ns'>
    <p>This specification defines the following XML namespaces:</p>
    <ul>
      <li>urn:xmpp:rayo:1</li>
      <li>urn:xmpp:rayo:client:1</li>
      <li>urn:xmpp:rayo:ext:1</li>
      <li>urn:xmpp:rayo:ext:complete:1</li>
      <li>urn:xmpp:rayo:output:1</li>
      <li>urn:xmpp:rayo:input:1</li>
      <li>urn:xmpp:rayo:record:1</li>
    </ul>
    <p>The &REGISTRAR; includes the foregoing namespaces in its registry at &NAMESPACES;, as governed by &xep0053;.</p>
  </section2>
  <section2 topic='Namespace Versioning' anchor='registrar-versioning'>
    <p>If the protocol defined in this specification undergoes a major revision that is not fully backward-compatible with an older version, or that contains significant new features, the XMPP Registrar shall increment the protocol version number found at the end of the XML namespaces defined herein, as described in Section 4 of <cite>XEP-0053</cite>.</p>
  </section2>
  <section2 topic='Rayo Components Registry' anchor='registrar-components'>
    <p>The XMPP Registrar maintains a registry of Rayo components. All component registrations with the exception of those defined above shall be defined in separate specifications (not in this document). Components defined within the XEP series MUST be registered with the XMPP Registrar, resulting in protocol URNs of the form "urn:xmpp:rayo:component_name:X" (where "component_name" is the registered name of the component and "X" is a non-negative integer).</p>
    &REGPROCESS;
    <code><![CDATA[
<component>
  <name>The name of the component.</name>
  <desc>A natural-language summary of the component.</desc>
  <doc>The document in which the component is specified.</doc>
</component>
    ]]></code>
  </section2>
</section1>
<section1 topic='XML Schema' anchor='schema'>
  <section2 topic='Rayo' anchor='schema-rayo'>
  <code><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:1"
  xmlns:tns="urn:xmpp:rayo:1"
  elementFormDefault="qualified">

  <annotation>
    <documentation>
      The protocol documented by this schema is defined at http://rayo.org/xep
    </documentation>
  </annotation>

  <!-- Header elements -->
  <complexType name="headerType">
    <attribute name="name" type="string" />
    <attribute name="value" type="string" />
  </complexType>

  <!-- Offer Event -->
  <element name="offer" type="tns:offerType" />
  <complexType name="offerType">
    <sequence>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
    <attribute name="to" type="anyURI" use="required" />
    <attribute name="from" type="anyURI" use="optional" />
  </complexType>

  <complexType name="callProgressType">
    <sequence>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
  </complexType>

  <!-- Answered Event -->
  <element name="answered" type="tns:callProgressType" />

  <!-- Ringing Event -->
  <element name="ringing" type="tns:callProgressType" />

  <!-- End Event -->
  <element name="end" type="tns:endType" />
  <complexType name="endType">
    <sequence>
      <choice>
        <element name="hungup" type="tns:empty" />
        <element name="timeout" type="tns:empty" />
        <element name="busy" type="tns:empty" />
        <element name="reject" type="tns:empty" />
        <element name="error" type="tns:empty" />
      </choice>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
  </complexType>

  <!-- Answer Command -->
  <element name="answer" type="tns:answerType" />
  <complexType name="answerType">
    <sequence>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
  </complexType>

  <!-- Redirect Command -->
  <element name="redirect" type="tns:redirectType" />
  <complexType name="redirectType">
    <sequence>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
    <attribute name="to" type="anyURI" />
  </complexType>

  <!-- Reject Command -->
  <element name="reject" type="tns:rejectType" />
  <complexType name="rejectType" mixed="true">
    <sequence>
      <choice>
        <element name="decline" type="tns:empty" />
        <element name="busy" type="tns:empty" />
        <element name="error" type="tns:empty" />
      </choice>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
  </complexType>

  <!-- Hangup Command -->
  <element name="hangup" type="tns:hangupType" />
  <complexType name="hangupType">
    <sequence>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
  </complexType>

  <!-- Dial Command -->
  <element name="dial" type="tns:callType" />
  <complexType name="callType">
    <sequence>
      <element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" />
    </sequence>
    <attribute name="to" type="anyURI" use="required" />
    <attribute name="from" type="anyURI" use="optional" />
    <attribute name="timeout" type="long" use="optional">
      <annotation>
        <documentation>
          Timeout is in milleseconds
        </documentation>
      </annotation>
    </attribute>
  </complexType>

  <!-- Resource Reference -->
  <element name="ref" type="tns:ref" />
  <complexType name="ref">
    <attribute name="id" type="string" use="required" />
  </complexType>

  <!-- Utility: Empty Type -->
  <simpleType name="empty">
    <restriction base="string">
      <enumeration value='' />
    </restriction>
  </simpleType>

</schema>
    ]]></code>
  </section2>
  <section2 topic='Rayo Ext' anchor='schema-rayo-ext'>
  <code><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:ext:1"
  xmlns:tns="urn:xmpp:rayo:ext:1"
  elementFormDefault="qualified">

  <annotation>
    <documentation>
      The protocol documented by this schema is defined at http://rayo.org/xep
    </documentation>
  </annotation>

  <!-- Stop Command -->
  <element name="stop" type="tns:empty" />

  <!-- Complete Event -->
  <element name="complete" type="tns:completeEvent" />
  <complexType name="completeEvent" mixed="true">
    <choice minOccurs="1" maxOccurs="1">
      <any />
    </choice>
  </complexType>

  <!-- Utility: Empty Type -->
  <simpleType name="empty">
    <restriction base="string">
      <enumeration value='' />
    </restriction>
  </simpleType>

</schema>
    ]]></code>
  </section2>
  <section2 topic='Rayo Ext Complete' anchor='schema-rayo-ext-complete'>
  <code><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:ext:complete:1"
  xmlns:tns="urn:xmpp:rayo:ext:complete:1"
  elementFormDefault="qualified">

  <annotation>
    <documentation>
      The protocol documented by this schema is defined at http://rayo.org/xep
    </documentation>
  </annotation>

  <!-- Complete due to a <stop/> command -->
  <element name="stop" type="tns:completeReason" />

  <!-- Complete due to a hangup -->
  <element name="hangup" type="tns:completeReason" />

  <!-- Complete due to a system error -->
  <element name="error" type="string" />

  <complexType name="completeReason" mixed="true">
    <any />
  </complexType>

  <!-- Utility: Empty Type -->
  <simpleType name="empty">
    <restriction base="string">
      <enumeration value='' />
    </restriction>
  </simpleType>

</schema>
    ]]></code>
  </section2>
  <section2 topic='Rayo Output' anchor='schema-rayo-output'>
  <code><![CDATA[

    ]]></code>
  </section2>
  <section2 topic='Rayo Output Complete' anchor='schema-rayo-output-complete'>
  <code><![CDATA[

    ]]></code>
  </section2>
  <section2 topic='Rayo Input' anchor='schema-rayo-input'>
  <code><![CDATA[

    ]]></code>
  </section2>
  <section2 topic='Rayo Input Complete' anchor='schema-rayo-input-complete'>
  <code><![CDATA[

    ]]></code>
  </section2>
  <section2 topic='Rayo Record' anchor='schema-rayo-record'>
  <code><![CDATA[

    ]]></code>
  </section2>
  <section2 topic='Rayo Record Complete' anchor='schema-rayo-record-complete'>
  <code><![CDATA[

    ]]></code>
  </section2>
</section1>
</xep>
